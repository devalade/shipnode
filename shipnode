#!/usr/bin/env bash
#
# ShipNode - Modular Version
# Main entry point that sources all modules
#

set -e

# Get the directory where this script is located
SHIPNODE_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
LIB_DIR="$SHIPNODE_DIR/lib"

# Source all library modules in order
source "$LIB_DIR/core.sh"
source "$LIB_DIR/rsync-installer.sh"
source "$LIB_DIR/pkg-manager.sh"
source "$LIB_DIR/release.sh"
source "$LIB_DIR/database.sh"
source "$LIB_DIR/users.sh"
source "$LIB_DIR/framework.sh"
source "$LIB_DIR/validation.sh"
source "$LIB_DIR/prompts.sh"
source "$LIB_DIR/templates.sh"

# Source command modules
source "$LIB_DIR/commands/config.sh"
source "$LIB_DIR/commands/users-yaml.sh"
source "$LIB_DIR/commands/user.sh"
source "$LIB_DIR/commands/mkpasswd.sh"
source "$LIB_DIR/commands/init.sh"
source "$LIB_DIR/commands/setup.sh"
source "$LIB_DIR/commands/deploy.sh"
source "$LIB_DIR/commands/doctor.sh"
source "$LIB_DIR/commands/status.sh"
source "$LIB_DIR/commands/unlock.sh"
source "$LIB_DIR/commands/rollback.sh"
source "$LIB_DIR/commands/migrate.sh"
source "$LIB_DIR/commands/env.sh"
source "$LIB_DIR/commands/upgrade.sh"
source "$LIB_DIR/commands/help.sh"

# Source and run main entry point
source "$LIB_DIR/commands/main.sh"

# Execute main with all arguments
main "$@"
